w <- (1.41, 1.98, 2.72, 3.73, 4.85, 6.1, 7.28, 8.34, 9.32, 10.01, 11.57)
m <- (0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20)
n <- 1000;
n0 <- N;
b < -NULL;
for (a in 1:length(w)) {
n1 <- n0*exp(-m[a]);
n <- c(n, n1);
n0 <- n1;
b <- c(b, n0*w[a + 1]);
}
plot(1:length(w), b, xlab='Age', ylab='g', main='Development of Saithe yearclass', type='l', ylim=c(0,2500))
w <- (1.41, 1.98, 2.72, 3.73, 4.85, 6.1, 7.28, 8.34, 9.32, 10.01, 11.57)
# development of a yearclass biome
w <- c(1.41, 1.98, 2.72, 3.73, 4.85, 6.1, 7.28, 8.34, 9.32, 10.01, 11.57)
m <- c(0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20)
n <- 1000;
n0 <- N;
b < -NULL;
for (a in 1:length(w)) {
n1 <- n0*exp(-m[a]);
n <- c(n, n1);
n0 <- n1;
b <- c(b, n0*w[a + 1]);
}
plot(1:length(w), b, xlab='Age', ylab='g', main='Development of Saithe yearclass', type='l', ylim=c(0,2500))
# development of a yearclass biome
w <- c(1.41, 1.98, 2.72, 3.73, 4.85, 6.1, 7.28, 8.34, 9.32, 10.01, 11.57)
m <- c(0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20)
n <- 1000;
n0 <- n;
b < -NULL;
for (a in 1:length(w)) {
n1 <- n0*exp(-m[a]);
n <- c(n, n1);
n0 <- n1;
b <- c(b, n0*w[a + 1]);
}
plot(1:length(w), b, xlab='Age', ylab='g', main='Development of Saithe yearclass', type='l', ylim=c(0,2500))
b <- NULL;
for (a in 1:length(w)) {
n1 <- n0*exp(-m[a]);
n <- c(n, n1);
n0 <- n1;
b <- c(b, n0*w[a + 1]);
}
plot(1:length(w), b, xlab='Age', ylab='g', main='Development of Saithe yearclass', type='l', ylim=c(0,2500))
b
w <- c(1.41, 1.98, 2.72, 3.73, 4.85, 6.1, 7.28, 8.34, 9.32, 10.01, 11.57)
m <- c(0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20)
n <- 1000;
n0 <- n;
b <- NULL;
a <- 1
n1 <- n0*exp(-m[a]);
n <- c(n, n1);
n0 <- n1;
b <- c(b, n0*w[a + 1]);
n1
n
n0
b
m
# achieving same as above with cumsum()
n0 <- 1000
nvec <- exp(-c(0, cumsum(m)))*n0
nvec <- nvec[1:length(w)]
nvec
cumsum(m)
n
for (a in 1:length(w)) {
n1 <- n0*exp(-m[a]);
n <- c(n, n1);
n0 <- n1;
b <- c(b, n0*w[a + 1]);
}
n
nvec
# catch curve analysis
ages<-3:14
ycl74<- c( 2.61, 16.29, 13.77, 15.12, 12.71, 7.67, 2.05, 0.51, 0.22, 0.10, 0.05, 0.03)
ycl75<-c( 6.00, 28.43, 32.50, 23.25, 14.01, 8.38, 2.68, 1.06, 0.39, 0.14, 0.11, 0.01)
yl76<- c( 7.19, 28.53, 39.20, 28.35, 17.38, 7.34, 2.26, 0.81, 0.25, 0.16, 0.04, 0.02)
ycl77<-c(4.35, 13.30, 24.46, 18.94, 8.08, 4.20, 1.77, 0.59, 0.31, 0.09, 0.02, 0.01)
ycl78<-c(2.12, 20.81, 24.31, 15.33, 8.71, 4.44, 1.46, 0.46, 0.11, 0.05,0.01, 0.01)
mat<-cbind(ycl74,cl75,ycl76,ycl77,ycl78)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers")
legend(10,20,74:78,lty=1:5,
ol=1:5,lwd=2)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers")
legend(10,20,74:78,lty=1:5,
ol=1:5,lwd=2)
yc176<- c( 7.19, 28.53, 39.20, 28.35, 17.38, 7.34, 2.26, 0.81, 0.25, 0.16, 0.04, 0.02)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers")
legend(10,20,74:78,lty=1:5,
ol=1:5,lwd=2)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
ycl75<-c( 6.00, 28.43, 32.50, 23.25, 14.01, 8.38, 2.68, 1.06, 0.39, 0.14, 0.11, 0.01)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
yc176<- c( 7.19, 28.53, 39.20, 28.35, 17.38, 7.34, 2.26, 0.81, 0.25, 0.16, 0.04, 0.02)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
mat<-cbind(yc174,yc175,yc176,yc177,yc178)
ages<-3:14
ycl74<- c( 2.61, 16.29, 13.77, 15.12, 12.71, 7.67, 2.05, 0.51, 0.22, 0.10, 0.05, 0.03)
ycl75<-c( 6.00, 28.43, 32.50, 23.25, 14.01, 8.38, 2.68, 1.06, 0.39, 0.14, 0.11, 0.01)
ycl76<- c( 7.19, 28.53, 39.20, 28.35, 17.38, 7.34, 2.26, 0.81, 0.25, 0.16, 0.04, 0.02)
ycl77<-c(4.35, 13.30, 24.46, 18.94, 8.08, 4.20, 1.77, 0.59, 0.31, 0.09, 0.02, 0.01)
ycl78<-c(2.12, 20.81, 24.31, 15.33, 8.71, 4.44, 1.46, 0.46, 0.11, 0.05,0.01, 0.01)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers")
legend(10,20,74:78,lty=1:5,
ol=1:5,lwd=2)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers")
legend(10,20,74:78,lty=1:5,
col=1:5,lwd=2)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers",log="y")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
ages
mat
# catch curve analysis - mortality by age
ages<-3:14
ycl74<-c( 2.61, 16.29, 13.77, 15.12, 12.71, 7.67, 2.05, 0.51, 0.22, 0.10, 0.05, 0.03)
ycl75<-c( 6.00, 28.43, 32.50, 23.25, 14.01, 8.38, 2.68, 1.06, 0.39, 0.14, 0.11, 0.01)
ycl76<-c( 7.19, 28.53, 39.20, 28.35, 17.38, 7.34, 2.26, 0.81, 0.25, 0.16, 0.04, 0.02)
ycl77<-c( 4.35, 13.30, 24.46, 18.94, 8.08, 4.20, 1.77, 0.59, 0.31, 0.09, 0.02, 0.01)
ycl78<-c(2.12, 20.81, 24.31, 15.33, 8.71, 4.44, 1.46, 0.46, 0.11, 0.05,0.01, 0.01)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
fage<-4:(length(ages)-1)
lage<-5:length(ages)
diff<-log(mat[fage,1:5])-log(mat[lage,1:5])
matplot(ages[fage],diff,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Differenced catch of cohorts, in log-numbers")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
fage
lage
diff
ages
ages[fage]
log(mat[fage])
log(mat[lage])
fage<-4:(length(ages)-1)
lage<-5:length(ages)
lnc<-log(mat[fage,])
matplot(ages[fage],lnc,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="log-numbers",main="Catch of cohorts")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
fage<-5:(length(ages)-1)
lage<-6:length(ages)
lnc<-apply(log(mat[fage,]),1,mean)
rage<-ages[fage]
plot(rage,lnc,xlab="Age",ylab="log-numbers",main="Catch of cohorts on log-scale",type='p')
abline(lm(lnc~rage))
# catch curve analysis
ages<-3:14
ycl74<- c( 2.61, 16.29, 13.77, 15.12, 12.71, 7.67, 2.05, 0.51, 0.22, 0.10, 0.05, 0.03)
ycl75<-c( 6.00, 28.43, 32.50, 23.25, 14.01, 8.38, 2.68, 1.06, 0.39, 0.14, 0.11, 0.01)
ycl76<- c( 7.19, 28.53, 39.20, 28.35, 17.38, 7.34, 2.26, 0.81, 0.25, 0.16, 0.04, 0.02)
ycl77<-c(4.35, 13.30, 24.46, 18.94, 8.08, 4.20, 1.77, 0.59, 0.31, 0.09, 0.02, 0.01)
ycl78<-c(2.12, 20.81, 24.31, 15.33, 8.71, 4.44, 1.46, 0.46, 0.11, 0.05,0.01, 0.01)
mat<-cbind(ycl74,ycl75,ycl76,ycl77,ycl78)
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers")
legend(10,20,74:78,lty=1:5,
col=1:5,lwd=2)
# catch curve analysis - log-scale
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers",log="y")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
# catch curve analysis - differences in catches on log scale by age
fage<-4:(length(ages)-1)
lage<-5:length(ages)
diff<-log(mat[fage,1:5])-log(mat[lage,1:5])
matplot(ages[fage],diff,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Differenced catch of cohorts, in log-numbers")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
# catch curve analysis - log axis
fage<-4:(length(ages)-1)
lage<-5:length(ages)
lnc<-log(mat[fage,])
matplot(ages[fage],lnc,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="log-numbers",main="Catch of cohorts")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
# catch curve analysis by estimating Z
fage<-5:(length(ages)-1)
lage<-6:length(ages)
lnc<-apply(log(mat[fage,]),1,mean)
rage<-ages[fage]
plot(rage,lnc,xlab="Age",ylab="log-numbers",main="Catch of cohorts on log-scale",type='p')
abline(lm(lnc~rage))
# catch curve analysis - log-scale
matplot(ages,mat,type='l',lty=1:5,col=1:5,lwd=2,xlab="Age",ylab="Millions",main="Catch of cohorts, in numbers - log scale",log="y")
legend(10,20,74:78,lty=1:5,col=1:5,lwd=2)
fage
length(ages)
ages
lage
rage
fage
ages[fage]
lnc
mat[fage]
mat[fage,]
rm(list=ls())
m<-read.table("http://www.hi.is/~gunnar/kennsla/alsm/data/set103.dat",header=T)
head(m)
l<-tapply(m$le,m$aldur,mean)
n<-tapply(m$le,m$aldur,length)
l<-l[n>=5]         # only include data if we have more than 4 values
a<-as.numeric(names(l))
plot(a,l,xlim=c(0,12),ylim=c(0,100),xlab="Age",ylab="Llength (cm)")
source(fishdata.R)
getwd()
source(fishData.R)
getwd()
source(fishData.R)
source('fishData.R')
source('fishData.R', english=F)
?source
source('fishData.R'); english=F
source('fishData.R'); english=F
english=F
source('fishData.R')
head(fish)
l<-tapply(m$le,m$age,mean)
n<-tapply(m$le,m$aldur,length)
l<-l[n>=5]         # only include data if we have more than 4 values
a<-as.numeric(names(l))
plot(a,l,xlim=c(0,12),ylim=c(0,100),xlab="Age",ylab="Llength (cm)")
l<-tapply(m$le,m$aldur,mean)
n<-tapply(m$le,m$aldur,length)
l<-l[n>=5]         # only include data if we have more than 4 values
a<-as.numeric(names(l))
plot(a,l,xlim=c(0,12),ylim=c(0,100),xlab="Age",ylab="Llength (cm)")
l
n
a <- 0:25
k <- 0.1
t0 <- 0
linf <- 120
l <- linf*(1 - exp(-k*(t-t0)));
l <- linf*(1 - exp(-k*(t - t0)));
t <- 0:25
k <- 0.1
t0 <- 0
linf <- 120
l <- linf*(1 - exp(-k*(t - t0)));
l
plot(l ~ t)
plot(l ~ t, type='l')
t <- 0:25
k <- 0.1
t0 <- 0
linf <- 120
lhat <- linf*(1 - exp(-k*(t - t0)));
plot(t,lhat,ylim=c(0,120),type='l',lwd=2,xlab="Age",ylab="Theoretical length at age")
text(median(t),median(lhat),paste("K=",K," linf=",linf," t0=",t0),pos=4)
# next curve
k<-0.5
t0<-0
Linf<-120
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="blue",lwd=2)
text(median(t),median(lhat),paste("K=",K," linf=",Llinf," t0=",t0),pos=4)
# next curve
K<-0.1
t0<-0
Linf<-80
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="red",lwd=2)
text(median(t),median(lhat),paste("K=",K," linf=",linf," t0=",t0),pos=4)
t <- 0:25
k <- 0.1
t0 <- 0
linf <- 120
lhat <- linf*(1 - exp(-k*(t - t0)));
plot(t,lhat,ylim=c(0,120),type='l',lwd=2,xlab="Age",ylab="Theoretical length at age")
text(median(t),median(lhat),paste("K=",K," linf=",linf," t0=",t0),pos=4)
# next curve
k<-0.5
t0<-0
Linf<-120
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="blue",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",Llinf," t0=",t0),pos=4)
# next curve
K<-0.1
t0<-0
Linf<-80
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="red",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
t <- 0:25
k <- 0.1
t0 <- 0
linf <- 120
lhat <- linf*(1 - exp(-k*(t - t0)));
plot(t,lhat,ylim=c(0,120),type='l',lwd=2,xlab="Age",ylab="Theoretical length at age")
text(median(t),median(lhat),paste("K=",K," linf=",linf," t0=",t0),pos=4)
k<-0.5
t0<-0
Linf<-120
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="blue",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
K<-0.1
t0<-0
Linf<-80
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="red",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
t <- 0:25
k <- 0.1
t0 <- 0
linf <- 120
lhat <- linf*(1 - exp(-k*(t - t0)));
plot(t,lhat,ylim=c(0,120),type='l',lwd=2,xlab="Age",ylab="Theoretical length at age")
text(median(t),median(lhat),paste("K=",K," linf=",linf," t0=",t0),pos=4)
# next curve
k<-0.5
t0<-0
Linf<-120
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="blue",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
# next curve
K<-0.1
t0<-0
linf<-80
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="red",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
t <- 0:25
k <- 0.5
t0 <- 0
linf <- 120
lhat <- linf*(1 - exp(-k*(t - t0)));
plot(t,lhat,ylim=c(0,120),type='l',lwd=2,xlab="Age",ylab="Theoretical length at age")
text(median(t),median(lhat),paste("K=",K," linf=",linf," t0=",t0),pos=4)
# next curve
k<-0.1
t0<-0
Linf<-120
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="blue",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
# next curve
K<-0.1
t0<-0
linf<-80
lhat<-linf*(1-exp(-k*(t-t0)))
lines(t,lhat,col="red",lwd=2)
text(median(t),median(lhat),paste("K=",k," linf=",linf," t0=",t0),pos=4)
plot(a,l)
a
l
english=F
source('fishData.R')
l<-tapply(m$le,m$aldur,mean)
n<-tapply(m$le,m$aldur,length)
l<-l[n>=5]         # only include data if we have more than 4 values
a<-as.numeric(names(l))
plot(a,l,xlim=c(0,12),ylim=c(0,100),xlab="Age",ylab="Llength (cm)")
plot(a,l)
# first we must put the above model as a function
vonb <- function(b) {
linf <- b[1];
k <- b2;
t0 <- b[3];
lhat <- linf*(1-exp(-k*(t-t0)))
}
# set up function
sse.vonb <- function(b) {
lhat <- vonb(b);
s <- sum((l-lhat)^2);
return(s)
}
b <- c(linf=120, k=0.1, t0=0)
b
b <- c(linf=120, k=0.1, t0=0)
plot(vonb(b) ~ t)
vonb <- function(b) {
linf <- b[1];
k <- b[2];
t0 <- b[3];
lhat <- linf*(1-exp(-k*(t-t0)))
}
# set up function
sse.vonb <- function(b) {
lhat <- vonb(b);
s <- sum((l-lhat)^2);
return(s)
}
b <- c(linf=120, k=0.1, t0=0)
plot(vonb(b) ~ t)
sse.vonb(b)
l
t <- 2:6
b <- c(linf=120, k=0.1, t0=0)
plot(vonb(b) ~ t)
sse.vonb(b)
l
head(fish)
points(le~aldur, data=fish, col='red', cex=0.7)
t <- 2:6
b <- c(linf=135, k=0.1, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=135, k=0.1, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
sse.vonb(b)
t <- 2:max(fish$aldur)
b <- c(linf=135, k=0.2, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
sse.vonb(b)
t <- 2:max(fish$aldur)
b <- c(linf=120, k=0.2, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
sse.vonb(b)
t <- 2:max(fish$aldur)
b <- c(linf=100, k=0.2, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
sse.vonb(b)
t <- 2:max(fish$aldur)
b <- c(linf=135, k=0.15, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=120, k=0.15, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=110, k=0.15, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=80, k=0.17, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=100, k=0.17, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=115, k=0.15, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=110, k=0.16, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
sse.vonb(b)
t <- 2:max(fish$aldur)
b <- c(linf=110, k=0.16, t0=0)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=110, k=0.16, t0=2)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
t <- 2:max(fish$aldur)
b <- c(linf=120, k=0.16, t0=2)
plot(le~aldur, data=fish, col='red', cex=0.7)
points(vonb(b) ~ t, type='l')
?nlm
fm <- nlm(sse.vonb, c(100, 0.1, 0))
l
t <- 2:6
sse.vonb(b)
fm <- nlm(sse.vonb, c(100, 0.1, 0))
fm
plot(a,l)
vb.par <- c(linf=fm$estimate[1], k=fm$estimate[2], t0=fm$estimate[3])
lhat <- vonb(vb.par)
lines(a, lhat)
a
l
plot(a,l)
vb.par <- c(linf=fm$estimate[1], k=fm$estimate[2], t0=fm$estimate[3])
lhat <- vonb(vb.par)
lines(a, lhat)
